<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Specific Features</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Specific Features</h1>
</header>
<p>Npt documentation.</p>
<p>Reference: <a href="index.html">ANSI Common Lisp npt</a><br />
Prev: <a href="A4_Amalgamation.html">4. Amalgamation</a> Next: <a href="A6_Input.html">6. Input Module</a></p>
<h1 id="npt-specific-features">5.1 Npt-specific features</h1>
<p>This chapter introduces some of the features specific to npt. The functions and variables used by npt are available in the <code>npt-system</code> package.</p>
<p>This section describes the following.</p>
<ul>
<li><a href="#specific-2">5.2 Command Arguments</a></li>
<li><a href="#specific-3">5.3 Environment Variables</a></li>
<li><a href="#specific-4">5.4 Running the Garbage Collector</a></li>
<li><a href="#specific-5">5.5 Saving Core Files</a></li>
<li><a href="#specific-6">5.6 End of process</a></li>
<li><a href="#specific-7">5.7 Invoking the editor with the <code>ed</code> function</a></li>
<li><a href="#specific-8">5.8 Action of the <code>require</code> function</a></li>
<li><a href="#specific-9">5.9 Operation of EastAsianWidth</a></li>
<li><a href="#specific-10">5.10 Loading <code>load-logical-pathname-translations</code></a></li>
<li><a href="#specific-11">5.11 Using the <code>pathname</code></a></li>
<li><a href="#specific-12">5.12 Initial value of <code>random-state</code></a></li>
<li><a href="#specific-13">5.13 Arguments of <code>load</code> function</a></li>
</ul>
<h1 id="command-arguments"><a id="specific-2">5.2 Command Arguments</a></h1>
<p>The arguments of the npt command are stored in the following variable.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>npt-system::*arguments*</span></code></pre></div>
<p>The value is an array, where the first element is the command <code>npt</code> and the second and subsequent arguments are the arguments of the command.</p>
<p>As an example, suppose you execute the following command.</p>
<pre><code>$ npt -- 10 20 30
*</code></pre>
<p>The argument <code>--</code> specifies that the following arguments are to be used in the npt command.</p>
<p>The values are as follows</p>
<pre><code>* npt-system::*arguments*
#(&quot;npt&quot; &quot;10&quot; &quot;20&quot; &quot;30&quot;)</code></pre>
<h1 id="environment-variables"><a id="specific-3">5.3 Environment Variables</a></h1>
<p>Environment variables are stored in the following variable.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>npt-system::*environment*</span></code></pre></div>
<p>The value is a hash table.<br />
For example, the following command is used to get the value of a home directory <code>$HOME</code>.</p>
<pre><code>$ npt
* (gethash &quot;HOME&quot; npt-system::*environment*)
&quot;/home/username&quot;
T
*</code></pre>
<h2 id="running-the-garbage-collector"><a id="specific-4">5.4 Running the Garbage Collector</a></h2>
<p>Use the following command to start the garbage collector.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(npt-system:gc)</span></code></pre></div>
<p>The garbage collector is automatically run if the heap area is overwhelmed, but depending on the timing, it may not be judged in time and you may run out of memory.<br />
If there is an out-of-memory situation, a <code>LISP ABORT</code> is triggered.</p>
<p>Here is the function specification.<br />
<a href="D1_System.html#system-develop">Lisp Function: System Function</a></p>
<h2 id="saving-core-files"><a id="specific-5">5.5 Saving Core Files</a></h2>
<p>The following command will create the core file.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(npt-system:savecore file)</span></code></pre></div>
<p>This instruction executes the <code>savecore</code> condition of the <code>serious-condition</code> to terminate the npt.<br />
When it finishes with the correct <code>savecore</code> condition, it starts to save the core file.</p>
<p>To read the core file you created, use the <code>--core</code> argument of the npt command.</p>
<p>Here is the function specification.<br />
<a href="D1_System.html#system-develop">Lisp Function: System Function</a></p>
<h2 id="end-of-process"><a id="specific-6">5.6 End of process</a></h2>
<p>Exit npt with the following command</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(npt-system:exit code)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>(npt-system:quit code)</span></code></pre></div>
<p>The above two functions are exactly the same.<br />
They are <code>imported</code> into the <code>common-lisp-user</code> package by default so that you can run <code>(exit)</code> and <code>(quit)</code> at the npt prompt.<br />
This instruction executes the <code>exit</code> condition of the <code>serious-condition</code> to terminate the npt.</p>
<p>When it finishes with the correct <code>exit</code> condition, the argument is set to the exit code to finish the process.</p>
<p>Here is the function specification.<br />
<a href="D1_System.html#system-develop">Lisp Function: System Function</a></p>
<h2 id="invoking-the-editor-with-the-ed-function"><a id="specific-7">5.7 Invoking the editor with the <code>ed</code> function</a></h2>
<p>The Common Lisp function <code>ed</code> invokes an editor.<br />
This feature is supported by FreeBSD, Linux and Windows.</p>
<p>It is configurable to get the command names of the editors in the following order.</p>
<ol type="1">
<li>get a string from <code>npt-system::*ed-program*</code>.</li>
<li>get a string from the <code>EDITOR</code> environment variable</li>
<li>get the standard editor name</li>
</ol>
<p>The standard editor is <code>vi</code> for FreeBSD/Linux, <code>notepad.exe</code> for Windows, or <code>ed</code> for others.</p>
<h2 id="action-of-the-require-function"><a id="specific-8">5.8 Action of the <code>require</code> function</a></h2>
<p>The function <code>require</code> in Common Lisp can read a module from its name.<br />
The implementation in npt is almost the same as in sbcl.</p>
<p>When the <code>require</code> is executed, the variable <code>npt-system::*module-provider-functions*</code> is read as a list of functions, and the functions are executed with the <code>require</code> arguments in order from the first one.</p>
<p>If any function returns a value other than <code>NIL</code>, it considers the loading to be successful and exits.</p>
<p>Here is the function specification.<br />
<a href="D1_System.html#system-develop">Lisp Function: System Function</a></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> require-tmp </span>(var)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">load</span> (<span class="kw">merge-pathnames</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">format</span> <span class="kw">nil</span> <span class="st">&quot;~(~A~).lisp&quot;</span> var)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>          #p<span class="st">&quot;/tmp/&quot;</span>)))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>(<span class="kw">push</span> #&#39;require-tmp npt-system::*module-provider-functions*)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>(<span class="kw">require</span> &#39;aaa)</span></code></pre></div>
<p>The following are the results of the execution. (but a failure example)</p>
<pre><code>ERROR: NPT-SYSTEM::SIMPLE-FILE-ERROR
Cannot open file #P&quot;/tmp/aaa.lisp&quot;.

 0. ABORT            Return to eval-loop.
[1]* 0</code></pre>
<p>It shows that <code>require</code> tried to read the file <code>/tmp/aaa.lisp</code> and failed.</p>
<h2 id="operation-of-eastasianwidth"><a id="specific-9">5.9 Operation of EastAsianWidth</a></h2>
<p>EastAsianWidth is a representation of Unicode character width.<br />
For example, in the case of Japanese, the width of a character may be treated as two letters of the alphabet. The width of a character is used to format the output of <code>format</code> or Pretty Printing.</p>
<p>The following three functions are related to EastAsianWidth.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> eastasian-width </span>(var) ...)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> eastasian-get </span>(var) ...)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> eastasian-set </span>(var size &amp;optional errorp) ...)</span></code></pre></div>
<p>Here is the function specification.<br />
<a href="D1_System.html#others">Lisp Function: System Function</a></p>
<h3 id="the-function-eastasian-width">The function <code>eastasian-width</code></h3>
<p>Returns the size of EastAsianWidth from an object.</p>
<p>If the argument <code>var</code> is an integer, its size is returned as a Unicode character.<br />
If the argument <code>var</code> is a character, the size of the character is returned.<br />
If the argument <code>var</code> is a string, the total size of all characters in the string is returned.</p>
<p>The first returned value is the size of EastAsianWidth.<br />
The second return value is a boolean value to show whether the size is correct or not.</p>
<h3 id="the-function-eastasian-get">The function <code>eastasian-get</code></h3>
<p>EastAsianWidth categorizes characters into 6 categories: <code>N</code>, <code>A</code>, <code>H</code>, <code>W</code>, <code>F</code>, and <code>NA</code>. This function gets the number of characters in each category. The argument <code>var</code> is a <code>string-designer</code> and represents the name of the category.</p>
<p>The first returned value is the size of EastAsianWidth.<br />
The second return value is a symbol for the category, and the error is <code>NIL</code>.</p>
<p>Example.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (npt-system:eastasian-get :na)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>NPT-SYSTEM::NA</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (npt-system:eastasian-get :hello)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span></span></code></pre></div>
<h3 id="the-function-eastasian-set">The function <code>eastasian-set</code></h3>
<p>Set the size of a category of EastAsianWidth.</p>
<p>The argument <code>var</code> is a symbol for the category.<br />
The argument <code>size</code> is the size of the category.<br />
The argument <code>&amp;optional errorp</code> is whether the <code>error</code> condition occurs or not.</p>
<h2 id="loading-load-logical-pathname-translations"><a id="specific-10">5.10 Loading <code>load-logical-pathname-translations</code></a></h2>
<p>The function <code>load-logical-pathname-translations</code> is a feature to load the settings of a logical pathname from a file.<br />
The location of the file is implementation-dependent.<br />
npt searches for files based on the following special variables.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>npt-system::*load-logical-pathname-translations*</span></code></pre></div>
<p>The function <code>load-logical-pathname-translations</code> takes a string as an argument and loads the corresponding configuration file.<br />
For example, suppose that the following is executed</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">load-logical-pathname-translations</span> <span class="st">&quot;hello&quot;</span>)</span></code></pre></div>
<p>Suppose the configuration files are located in</p>
<pre><code>/tmp/host/hello.txt</code></pre>
<p>In this case, the value of the special variable should be set as follows</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">setq</span> npt-system::*load-logical-pathname-translations* #p<span class="st">&quot;/tmp/host/*.txt&quot;</span>)</span></code></pre></div>
<p>Let’s check the operation.<br />
First, create a configuration file. Here are the contents of the file.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(<span class="st">&quot;*.*&quot;</span> <span class="st">&quot;/home/lisp/&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>(<span class="st">&quot;path;to;*.*&quot;</span> <span class="st">&quot;/home/path/&quot;</span>)</span></code></pre></div>
<p>Create a configuration file.</p>
<pre><code>$ cd /tmp
$ mkdir host
$ cd host
$ vi hello.txt
Enter the above information
$</code></pre>
<p>npt to execute the following commands</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">load-logical-pathname-translations</span> <span class="st">&quot;hello&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>-&gt; <span class="kw">t</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>(<span class="kw">translate-logical-pathname</span> <span class="st">&quot;hello:name.txt&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>-&gt; #P<span class="st">&quot;/home/lisp/name.txt&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>(<span class="kw">translate-logical-pathname</span> <span class="st">&quot;hello:path;to;name.txt&quot;</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>-&gt; #P<span class="st">&quot;/home/path/name.txt&quot;</span></span></code></pre></div>
<p>It is converted correctly.</p>
<h2 id="using-the-pathname"><a id="specific-11">5.11 Using the <code>pathname</code></a></h2>
<p>The <code>pathmame</code> is an object for the name of a file.</p>
<p>The <code>pathname-host</code> specifies the environment to which the file name belongs.<br />
The following values are used by npt</p>
<table>
<thead>
<tr class="header">
<th><code>pathname-host</code></th>
<th>Environment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>npt-system::unix</code></td>
<td>Unix</td>
</tr>
<tr class="even">
<td><code>npt-system::windows</code></td>
<td>Windows</td>
</tr>
<tr class="odd">
<td>string-tyoe</td>
<td>logical-pathname</td>
</tr>
</tbody>
</table>
<p>The default is the value of <code>host</code> set to the <code>pathname</code> object of the <code>*default-pathname-defaults*</code>. The <code>parse-namestring</code> function determines how to analyze a string according to the value of <code>host</code>.<br />
Because the behavior is determined by the value of <code>host</code>, for example, even if the system is running on a Unix system, you can recognize Windows file names.</p>
<p>For example, the following.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">parse-namestring</span> <span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Windows</span><span class="sc">\\</span><span class="st">&quot;</span> &#39;npt-system::windows)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>#P<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Windows</span><span class="sc">\\</span><span class="st">&quot;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">pathname-directory</span> <span class="op">*</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>(:ABSOLUTE <span class="st">&quot;Windows&quot;</span>)</span></code></pre></div>
<p>The function <code>equal</code> allows you to check whether the <code>pathname</code> is the same or not.<br />
If the <code>namestring</code> is the same but the <code>host</code> is different, they are not the same.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">parse-namestring</span> <span class="st">&quot;notepad.exe&quot;</span> &#39;npt-system::windows)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>#P<span class="st">&quot;notepad.exe&quot;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">parse-namestring</span> <span class="st">&quot;notepad.exe&quot;</span> &#39;npt-system::unix)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>#P<span class="st">&quot;notepad.exe&quot;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">equal</span> <span class="op">**</span> <span class="op">*</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>NIL</span></code></pre></div>
<p>The <code>equal</code> function checks the value of <code>host</code> and evaluates the case of a string.<br />
On Unix, the value of <code>host</code> is considered to be different from the case of the string, and on Windows, it is considered to be the same.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">equal</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">parse-namestring</span> <span class="st">&quot;Hello.TXT&quot;</span> &#39;npt-system::unix)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">parse-namestring</span> <span class="st">&quot;hello.txt&quot;</span> &#39;npt-system::unix))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">equal</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">parse-namestring</span> <span class="st">&quot;Hello.TXT&quot;</span> &#39;npt-system::windows)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">parse-namestring</span> <span class="st">&quot;hello.txt&quot;</span> &#39;npt-system::windows))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<p>The <code>pathname-device</code> is ignored for Unix and logical paths.<br />
On Windows, it is set to the type of the file or the drive letter.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">pathname-device</span> (<span class="kw">parse-namestring</span> <span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Windows</span><span class="sc">\\</span><span class="st">&quot;</span> &#39;npt-system::windows))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;C&quot;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">pathname-device</span> (<span class="kw">parse-namestring</span> <span class="st">&quot;notepad.exe&quot;</span> &#39;npt-system::windows))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">pathname-device</span> (<span class="kw">parse-namestring</span> <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">COM1&quot;</span> &#39;npt-system::windows))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>NPT-SYSTEM::DEVICE</span></code></pre></div>
<p>The <code>pathname-version</code> is ignored on Unix and Windows, and is used by rules for logical paths.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">pathname-version</span> (<span class="kw">logical-pathname</span> <span class="st">&quot;test:hello.txt&quot;</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>:NEWEST</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">pathname-version</span> (<span class="kw">logical-pathname</span> <span class="st">&quot;test:hello.txt.999&quot;</span>))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dv">999</span></span></code></pre></div>
<h2 id="initial-value-of-random-state"><a id="specific-12">5.12 Initial value of <code>random-state</code></a></h2>
<p>The <code>random-state</code> is an object used to generate a random number.<br />
npt uses a random number generator called xorshift, which holds a 128-bit internal state in the <code>random-state</code>.</p>
<p>The initial value can be set to as random as possible by passing the argument <code>t</code> to the function <code>make-random-state</code>.<br />
For example</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">make-random-state</span> <span class="kw">t</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>#&lt;RANDOM-STATE <span class="ch">#x</span>85A5B416389D9716A81B4F43F76E922A&gt;</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">make-random-state</span> <span class="kw">t</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>#&lt;RANDOM-STATE <span class="ch">#x</span>E51C94EB01856FEAC5B1EC8C90E3107E&gt;</span></code></pre></div>
<p>Determining the initial value of a random number is not easy, so basically the operating system sets the initial value.<br />
This chapter describes how to get the initial value of a random number.</p>
<h3 id="freebsd-linux">FreeBSD / Linux</h3>
<p>If the compilation mode is FreeBSD or Linux, get the initial value of the random number from the file <code>/dev/urandom</code>.</p>
<p>Note that the device to be read is not <code>/dev/random</code>.<br />
On FreeBSD, there is no difference between the two, but on Linux, <code>/dev/random</code> is more secure.<br />
npt has chosen to use <code>/dev/urandom</code> for convenience rather than safety.</p>
<p>Takes 256 bytes of data from <code>/dev/urandom</code> and sends it to MD5 hash and set the internal state of MD5 to the internal state of xorshift as it is.</p>
<p>If reading <code>/dev/urandom</code> fails, it is an error.</p>
<h3 id="windows">Windows</h3>
<p>If the compilation mode is on Windows, get the initial value from the function <code>SystemFunction036</code>, commonly known as the <code>RtlGenRandom</code> function of <code>Advapi32.dll</code>.</p>
<p>Takes 256 bytes of data from <code>RtlGenRandom</code> and sends it to MD5 hash and set the internal state of MD5 to the internal state of xorshift as it is.</p>
<p>If reading <code>RtlGenRandom</code> fails, it is an error.</p>
<h3 id="ansi-c">ANSI-C</h3>
<p>Attempt to read the file <code>/dev/urandom</code>.<br />
If the value is obtained, it is used as the initial value.<br />
If the value can’t be obtained, it is given up and the time and so on are used as the initial value of the random number.</p>
<p>Unlike FreeBSD, Linux, and Windows, it continues without error even if the device could not be loaded for the initial value.</p>
<h2 id="arguments-of-load-function"><a id="specific-13">5.13 Arguments of <code>load</code> function</a></h2>
<p>The <code>load</code> function can load either a text file containing Lisp expressions or a binary file generated by the <code>compile-file</code> function (commonly known as a FASL file).<br />
Which one to load is determined by whether <code>pathname-type</code> is <code>FASL</code> or not, but the type can also be specified by the <code>:type</code> argument of the <code>load</code> function.</p>
<p>To load a text file.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">load</span> file <span class="bu">:type</span> :lisp)</span></code></pre></div>
<p>To load a fasl file.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">load</span> file <span class="bu">:type</span> :fasl)</span></code></pre></div>
<p>The first argument of the <code>load</code> function is not only <code>pathname</code>, but can also be <code>memory-stream</code>.<br />
However, since <code>memory-stream</code> does not have a <code>pathname</code>, you need to specify the <code>:type</code> argument.</p>
<p>Here is an example of execution.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">let</span> ((input (npt-system:make-memory-io-stream))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>      (output (npt-system:make-memory-io-stream)))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">with-open-file</span> (<span class="kw">stream</span> input <span class="bu">:direction</span> <span class="bu">:output</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">format</span> <span class="kw">stream</span> <span class="st">&quot;(format t </span><span class="sc">\&quot;</span><span class="st">Hello~~%</span><span class="sc">\&quot;</span><span class="st">)&quot;</span>))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">with-open-file</span> (<span class="kw">stream</span> input <span class="bu">:direction</span> <span class="bu">:input</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">compile-file</span> <span class="kw">stream</span> <span class="bu">:output-file</span> output))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">file-position</span> output <span class="bu">:start</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">load</span> output <span class="bu">:type</span> :fasl))</span></code></pre></div>
<p>Here are the execution results.</p>
<pre><code>Hello
T</code></pre>
<p>In this example, a text file is written to the <code>input</code> variable, and a fasl file is output to the <code>output</code> variable by the <code>compile-file</code> function.<br />
After returning the file pointer of the output to the top, execute the fasl file generated by the <code>load</code> function.</p>
</body>
</html>
